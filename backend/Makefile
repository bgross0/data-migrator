.PHONY: demo test determinism clean

demo:
	@echo "ðŸš€ Running demo export pipeline..."
	@echo "ðŸ“¦ Creating output directory..."
	@mkdir -p out/demo
	@echo "âœ“ Output directory created"
	@echo ""
	@echo "Note: Full demo requires database setup."
	@echo "Run 'make test' to verify all components work."
	@echo ""

test:
	@echo "ðŸ§ª Running test suite..."
	pytest -v tests/test_registry_loader.py tests/test_normalizers.py tests/test_validator.py tests/test_csv_emitter.py
	@echo ""
	@echo "âœ… All tests passed!"

determinism:
	@echo "ðŸ” Testing determinism (byte-identical exports)..."
	@PYTHONPATH=. venv/bin/pytest -v tests/test_determinism.py
	@echo ""
	@echo "âœ… Determinism verified: SHA256 hashes match!"

clean:
	@echo "ðŸ§¹ Cleaning output directories..."
	@rm -rf out/demo
	@find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	@find . -type d -name .pytest_cache -exec rm -rf {} + 2>/dev/null || true
	@echo "âœ“ Cleanup complete"

all-tests:
	@echo "ðŸ§ª Running full test suite..."
	@pytest -v
	@echo ""
	@echo "ðŸ“Š Test coverage:"
	@pytest --cov=app --cov-report=term-missing
	@echo ""
	@echo "âœ… Full test suite complete!"
